<html>
    <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=Edge;chrome=1" > 
      <link rel="shortcut icon" type="image/x-icon" href="./favicon.ico">
      <link type="text/css" rel="stylesheet" href="css/jquery.contextMenu.css">
      <link rel="stylesheet" href="css/dhtmlwindow.css" type="text/css">
      <link type="text/css" rel="stylesheet" href="js9.css">
      <script type="text/javascript" src="js/jquery.min.js"></script>
      <script type="text/javascript" src="js/kinetic.min.js"></script>
      <script type="text/javascript" src="js/jquery.contextMenu.min.js"></script>
      <script type="text/javascript" src="js/jquery.flot.min.js"></script>
      <script type="text/javascript" src="js/jquery.flot.errorbars.min.js"></script>
      <script type="text/javascript" src="js/sprintf.min.js"></script>
      <script type="text/javascript" src="js/dhtmlwindow.min.js">
      /***********************************************
      * DHTML Window Widget- Â© Dynamic Drive (www.dynamicdrive.com)
      * This notice must stay intact for legal use.
      * Visit http://www.dynamicdrive.com/ for full source code
      ***********************************************/
      </script>
      <script type="text/javascript" src="js/fitsy.js"></script>
      <script type="text/javascript" src="js/astrolib.js"></script>
      <script type="text/javascript" src="js9.js"></script>

        <script>

	function status(message) {
	    $("#status").text(message)
	}


	HTTP="www.cfa.harvard.edu"

 	function xhr(url, func) {
	    var xhr = new XMLHttpRequest();

	    xhr.open('GET', url, true);
	    xhr.onload = func

	    return xhr;
	}

	function ImageGo() {
	    var form = $("#archive-box")[0]

	    if ( form.object.value === "" && ( form.ra.value === "" || form.dec.value === "" ) ) {
		return;
	    }

	    w = parseFloat(form.width.value)
	    h = parseFloat(form.height.value)

	    if ( w > 60 ) {
		form.width.value = "60";
		w = 60;
	    }
	    if ( h > 60 ) {
		form.height.value = "60";
		h = 60;
	    }

	    if ( form.object.value !== "" ) {
		simbad=encodeURI('http://hopper.si.edu/http/simbad?' + form.object.value)

		var reply = xhr(simbad, function(e) {
		    var coords = reply.responseText.split(" ");

		    form.ra.value  = coords[0]
		    form.dec.value = coords[1]

		    status("");
		    getimage(form.object.value, "J2000", h.toString(), w.toString()
				, form.ra.value, form.dec.value
				, form.gzip.value, $("#status"));
		})
		reply.addEventListener("progress", function(e) { status("progress " + e.loaded.toString()) });
		reply.addEventListener("error"	 , function(e) { status("Name service error"); });
		reply.addEventListener("abort"	 , function(e) { status("Name service aborted"); });
	        reply.send();

		return
	    }

	    getimage(form.object.value, "J2000", h.toString(), w.toString()
		    	, form.ra.value, form.dec.value
		    	, form.gzip.value, $("#status"));
	}

	function getimage(name, e, h, w, r, d, c, messages) {
	    var gzip;

	    if ( c === "on" ) {
		gzip = "c=gzip&"
	    } else {
		gzip = ""
	    }

	    url = "http://" + HTTP + "/archive/dss?" + gzip + "&e=" + e + "&h=" + h + "&w=" + w + "&r=" + r + "&d=" + d

	    Fitsy.fetchURL(name, url, messages);
	}

        </script>
    </head>
    <body>
    <div class="JS9Menubar"></div>
    <div class="JS9"></div>

        <br>
	<form id="archive-box">


	Image archive : SAO DSS <p>

	<table>
	<tr><td> Object: </td> <td> <input type=text name=object size=10> </td>
	    <td></td>
	    <td></td>
	    <td> <input type=button value=Go onclick='ImageGo()'> </td>
	    <td>&nbsp;&nbsp;</td>
	    <td> <input type=checkbox name=gzip> Use Compression</td>
	</tr>
	<tr><td> RA:  	</td><td>	<input type=text name=ra	size=10> </td>
	    <td> Dec: 	</td><td>	<input type=text name=dec	size=10> </td>
	<tr><td> Width: </td><td>	<input type=text name=width	size=10 value=15> </td>
	    <td> Height: </td><td>	<input type=text name=height	size=10 value=15> </td>
	</tr>
	</tr>
	<tr><td colspan=6><span id=status></span></td></tr>

	</form>
    </body>
</html>
